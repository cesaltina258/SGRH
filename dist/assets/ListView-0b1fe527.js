import{d as H,l as r,c as T,J as G,B as U,b as L,e as B,w as t,x as a,O as F,aD as q,C as W,y as te,a1 as ie,h as D,D as J,G as I,i as d,Q as k,I as _,f as E,a3 as le,ab as se,Z as de,aK as N,K as ue,L as ve,af as ce,m as me,M as z,aF as pe,N as fe,g as A,R as ge,H as he,F as Q,E as _e,S as ye,V as Ve,W as $e}from"./index-1db35709.js";import{_ as xe}from"./TableAction.vue_vue_type_script_setup_true_lang-6eb16471.js";import{D as Le}from"./DataTableServer-f256364c.js";const Re=[{title:"leave-reason",disabled:!1},{title:"view-leave-reason-list",disabled:!0}],ee=[{title:"reason",key:"reason",sortable:!0},{title:"description",key:"description",sortable:!0},{title:"action",sortable:!1}],we={class:"font-weight-bold text-caption mb-1"},Ce=d("i",{class:"ph-asterisk ph-xs text-danger"},null,-1),be={key:0,class:"text-red text-extra-small pt-1"},Se={class:"font-weight-bold text-caption mb-1"},Pe={key:0,class:"text-red text-extra-small pt-1"},Ie=d("i",{class:"ph-x me-1"},null,-1),De=H({__name:"CreateUpdateLeaveReasonModal",props:{modelValue:{type:Boolean,default:!1},data:{type:Object,required:!0},error:{type:String,default:""}},emits:["update:modelValue","onSubmit"],setup(c,{emit:m}){const p=r(!1),f=m,R=c,$=T(()=>R.data.id==="-1"),i=r(R.data),g=T({get(){return R.modelValue},set(o){f("update:modelValue",o)}}),x=r(i.value.id||""),n=r(i.value.name||""),u=r(i.value.description||""),v=T(()=>R.error),y=r({name:"",description:""}),{t:M}=G(),C=()=>{let o=!0;return Object.keys(y.value).forEach(V=>{y.value[V]=""}),n.value||(y.value.name=M("t-please-enter-leave-reason"),o=!1),o},w=()=>{if(!C())return;p.value=!0;const o={...!$.value&&{id:x.value},name:n.value,description:u.value};f("onSubmit",o,{onSuccess:()=>{g.value=!1},onFinally:()=>{p.value=!1}})};return(o,V)=>{const O=U("TextField"),K=U("TextArea"),j=U("Card");return L(),B(se,{modelValue:g.value,"onUpdate:modelValue":V[4]||(V[4]=P=>g.value=P),width:"500",scrollable:""},{default:t(()=>[a(j,{title:$.value?o.$t("t-add-leave-reason"):o.$t("t-edit-leave-reason"),"title-class":"py-0",style:{overflow:"hidden"}},{"title-action":t(()=>[a(F,{icon:"ph-x",variant:"plain",onClick:V[0]||(V[0]=P=>g.value=!1)})]),default:t(()=>[a(q),a(W,{class:"overflow-y-auto",style:te({"max-height":$.value?"70vh":"45vh"})},{default:t(()=>[v.value?(L(),B(ie,{key:0,text:v.value,type:"error",class:"mb-4",variant:"tonal",color:"danger",density:"compact"},null,8,["text"])):D("",!0),a(J,null,{default:t(()=>[a(I,{cols:"12",lg:"12"},{default:t(()=>[d("div",we,[k(_(o.$t("t-reason"))+" ",1),Ce]),a(O,{modelValue:n.value,"onUpdate:modelValue":V[1]||(V[1]=P=>n.value=P),placeholder:o.$t("t-enter-reason"),"error-messages":y.value.name?[y.value.name]:[],"hide-details":""},null,8,["modelValue","placeholder","error-messages"]),y.value.name?(L(),E("div",be,_(y.value.name),1)):D("",!0)]),_:1}),a(I,{cols:"12",lg:"12"},{default:t(()=>[d("div",Se,_(o.$t("t-description")),1),a(K,{modelValue:u.value,"onUpdate:modelValue":V[2]||(V[2]=P=>u.value=P),placeholder:o.$t("t-enter-description"),"error-messages":y.value.description?[y.value.description]:[],"hide-details":""},null,8,["modelValue","placeholder","error-messages"]),y.value.description?(L(),E("div",Pe,_(y.value.description),1)):D("",!0)]),_:1})]),_:1})]),_:1},8,["style"]),a(q),a(le,{class:"d-flex justify-end"},{default:t(()=>[d("div",null,[a(F,{color:"danger",class:"me-1",onClick:V[3]||(V[3]=P=>g.value=!1)},{default:t(()=>[Ie,k(" "+_(o.$t("t-close")),1)]),_:1}),a(F,{color:"primary",variant:"elevated",onClick:w,loading:p.value,disabled:p.value},{default:t(()=>[k(_(p.value?o.$t("t-saving"):o.$t("t-save")),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])}}});const Ee={class:"font-weight-bold text-caption mb-1"},Te=d("i",{class:"ph-asterisk ph-xs text-danger"},null,-1),Ue={key:0,class:"text-red text-extra-small pt-1"},Oe={class:"font-weight-bold text-caption mb-1"},Be={key:0,class:"text-red text-extra-small pt-1"},Fe=d("i",{class:"ph-x me-1"},null,-1),ke=H({__name:"ViewLeaveReasonModal",props:{modelValue:{type:Boolean,default:!1},data:{type:Object,required:!0}},emits:["update:modelValue","onSubmit"],setup(c,{emit:m}){r(!1);const p=m,f=c,R=T(()=>f.data.id==="-1"),$=r(f.data),i=T({get(){return f.modelValue},set(u){p("update:modelValue",u)}});r($.value.id||"");const g=r($.value.name||""),x=r($.value.description||""),n=r({name:"",description:""});return G(),(u,v)=>{const y=U("TextField"),M=U("TextArea"),C=U("Card");return L(),B(se,{modelValue:i.value,"onUpdate:modelValue":v[4]||(v[4]=w=>i.value=w),width:"500",scrollable:""},{default:t(()=>[a(C,{title:u.$t("t-view-leave-reason"),"title-class":"py-0",style:{overflow:"hidden"}},{"title-action":t(()=>[a(F,{icon:"ph-x",variant:"plain",onClick:v[0]||(v[0]=w=>i.value=!1)})]),default:t(()=>[a(q),a(W,{class:"overflow-y-auto",style:te({"max-height":R.value?"70vh":"45vh"})},{default:t(()=>[a(J,null,{default:t(()=>[a(I,{cols:"12",lg:"12"},{default:t(()=>[d("div",Ee,[k(_(u.$t("t-name"))+" ",1),Te]),a(y,{modelValue:g.value,"onUpdate:modelValue":v[1]||(v[1]=w=>g.value=w),placeholder:u.$t("t-enter-name"),"error-messages":n.value.name?[n.value.name]:[],"hide-details":"",disabled:""},null,8,["modelValue","placeholder","error-messages"]),n.value.name?(L(),E("div",Ue,_(n.value.name),1)):D("",!0)]),_:1}),a(I,{cols:"12",lg:"12"},{default:t(()=>[d("div",Oe,_(u.$t("t-description")),1),a(M,{modelValue:x.value,"onUpdate:modelValue":v[2]||(v[2]=w=>x.value=w),placeholder:u.$t("t-enter-description"),"error-messages":n.value.description?[n.value.description]:[],"hide-details":"",disabled:""},null,8,["modelValue","placeholder","error-messages"]),n.value.description?(L(),E("div",Be,_(n.value.description),1)):D("",!0)]),_:1})]),_:1})]),_:1},8,["style"]),a(q),a(le,{class:"d-flex justify-end"},{default:t(()=>[d("div",null,[a(F,{color:"danger",class:"me-1",onClick:v[3]||(v[3]=w=>i.value=!1)},{default:t(()=>[Fe,k(" "+_(u.$t("t-close")),1)]),_:1})])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])}}});const Me=de("leave_reason",{state:()=>({leave_reason:[],pagination:{totalElements:0,currentPage:0,itemsPerPage:10,totalPages:0},loading:!1,error:null,draftLeaveReason:null,currentLeaveReasonId:null}),actions:{async fetchLeaveReasons(c,m,p="name",f="asc",R,$){this.loading=!0,this.error=null;const i=c??this.pagination.currentPage,g=m??this.pagination.itemsPerPage;try{const{content:x,meta:n}=await N.getLeaveReasons(i,g,p,f,R,$);this.leave_reason=x,this.pagination={totalElements:n.totalElements,currentPage:n.page,itemsPerPage:n.size,totalPages:n.totalPages||Math.ceil(n.totalElements/n.size)},console.log("📝 Motivos de Ausência:",this.leave_reason),console.log("📊 Paginação:",this.pagination)}catch(x){this.error=x.message||"Erro ao buscar motivos de ausência",this.leave_reason=[],this.pagination.totalElements=0,console.error("❌ Erro ao buscar motivos de ausência:",x)}finally{this.loading=!1}},setDraftLeaveReason(c){this.draftLeaveReason=c,localStorage.setItem("draftLeaveReason",JSON.stringify(c)),console.log("📋 Draft de motivo de ausência salvo:",this.draftLeaveReason)},setCurrentLeaveReasonId(c){this.currentLeaveReasonId=c,localStorage.setItem("currentLeaveReasonId",c),console.log("🆔 ID do motivo de ausência atual salvo:",this.currentLeaveReasonId)},clearDraft(){this.draftLeaveReason=null,this.currentLeaveReasonId=null,localStorage.removeItem("draftLeaveReason"),localStorage.removeItem("currentLeaveReasonId"),console.log("🧹 Draft e ID de motivo de ausência limpos")},loadFromStorage(){const c=localStorage.getItem("draftLeaveReason"),m=localStorage.getItem("currentLeaveReasonId");c&&(this.draftLeaveReason=JSON.parse(c)),m&&(this.currentLeaveReasonId=m),console.log("📦 Dados recuperados do armazenamento:",this.draftLeaveReason,this.currentLeaveReasonId)}}}),Ae={class:"text-body-1 font-weight-bold"},je=d("i",{class:"ph-plus-circle me-1"},null,-1),ze={style:{"padding-right":"200px"}},Ne={style:{"padding-right":"200px"}},qe=["colspan"],Je=d("i",{class:"ph-magnifying-glass",style:{"font-size":"30px"}},null,-1),He={class:"text-subtitle-1 font-weight-bold mt-3"},ae="name,description",Ke=H({__name:"index",setup(c){const{t:m}=G(),p=ue(),f=Me();ve();const R=r(!1),$=r(!1),i=r(null),g=r(!1),x=r(null),n=r(!1);r(!1);const u=r(""),v=r(10),y=T(()=>f.loading),M=T(()=>f.pagination.totalElements),C=r([]),w=r("");let o=null;const V=e=>{var s,h,S,b,Z,X,Y;o&&(clearTimeout(o),o=null);const l=((Z=(b=(S=(h=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:h.error)==null?void 0:S.errors)==null?void 0:b.name)==null?void 0:Z[0])||((Y=(X=e==null?void 0:e.response)==null?void 0:X.data)==null?void 0:Y.message)||(e==null?void 0:e.message)||m("t-message-save-error");console.error("Erro:",l),w.value=l,o=setTimeout(()=>{w.value="",o=null},5e3)};ce(()=>{o&&(clearTimeout(o),o=null)}),me(()=>{O({page:1,itemsPerPage:v.value,sortBy:[],search:""})}),z(C,e=>{console.log("Funcionários selecionados:",e)},{deep:!0});const O=async({page:e,itemsPerPage:l,sortBy:s,search:h})=>{var S,b;await f.fetchLeaveReasons(e-1,l,((S=s[0])==null?void 0:S.key)||"name",((b=s[0])==null?void 0:b.order)||"asc",h,ae)},K=e=>{C.value.findIndex(s=>s.id===e.id)===-1?C.value=[...C.value,e]:C.value=C.value.filter(s=>s.id!==e.id)};z(R,e=>{e||(i.value=null)});const j=e=>{e?i.value=e:i.value={id:"-1",name:"",description:""},R.value=!0},P=async(e,l)=>{var s,h;try{e.id?(await N.updateLeaveReason(e.id,e),p.success(m("t-toast-message-update"))):(await N.createLeaveReason(e),p.success(m("t-toast-message-created"))),await O({page:1,itemsPerPage:v.value,sortBy:[],search:u.value}),(s=l==null?void 0:l.onSuccess)==null||s.call(l)}catch(S){p.error(m("t-message-save-error")),V(S)}finally{(h=l==null?void 0:l.onFinally)==null||h.call(l)}};z($,e=>{e||(i.value=null)});const oe=e=>{e?i.value=e:i.value={id:"-1",name:"",description:""},$.value=!0};z(g,e=>{e||(x.value=null)});const ne=e=>{x.value=e,g.value=!0},re=async()=>{n.value=!0;try{await N.deleteLeaveReason(x.value),await O({page:1,itemsPerPage:v.value,sortBy:[],search:u.value}),p.success(m("t-toast-message-deleted"))}catch(e){p.error(m("t-toast-message-deleted-erros")),V(e)}finally{n.value=!1,g.value=!1}};return(e,l)=>(L(),E(Q,null,[a(Ve,null,{default:t(()=>[a(pe,{class:"mt-2"},{default:t(()=>[a(J,{justify:"space-between",align:"center","no-gutters":""},{default:t(()=>[a(I,{lg:"auto",class:"d-flex align-center"},{default:t(()=>[d("span",Ae,_(e.$t("t-leave-reason-list")),1)]),_:1}),a(I,{lg:"8",class:"d-flex justify-end"},{default:t(()=>[a(J,{justify:"end",align:"center","no-gutters":""},{default:t(()=>[a(I,{lg:"4",class:"me-3"},{default:t(()=>[a(fe,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=s=>u.value=s),placeholder:e.$t("t-search-for-leave-reason")},null,8,["modelValue","placeholder"])]),_:1}),a(I,{lg:"auto"},{default:t(()=>[a(F,{color:"secondary",onClick:l[1]||(l[1]=s=>j(null))},{default:t(()=>[je,k(" "+_(e.$t("t-add-leave-reason")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(W,{class:"mt-2"},{default:t(()=>[a(Le,{headers:A(ee).map(s=>({...s,title:e.$t(`t-${s.title}`)})),items:A(f).leave_reason,"items-per-page":v.value,"total-items":M.value,loading:y.value,"search-query":u.value,"search-props":ae,"item-value":"id",onLoadItems:O},ge({body:t(({items:s})=>[(L(!0),E(Q,null,_e(s,h=>{var S;return L(),E("tr",{key:h.id,height:"50"},[d("td",null,[a(ye,{"model-value":C.value.some(b=>b.id===h.id),"onUpdate:modelValue":b=>K(h),"hide-details":"",density:"compact"},null,8,["model-value","onUpdate:modelValue"])]),d("td",ze,_(h.name),1),d("td",Ne,_((S=h.description)==null?void 0:S.toUpperCase()),1),d("td",null,[a(xe,{onOnEdit:b=>j(h),onOnView:b=>oe(h),onOnDelete:b=>ne(h.id)},null,8,["onOnEdit","onOnView","onOnDelete"])])])}),128))]),_:2},[A(f).leave_reason.length?void 0:{name:"body",fn:t(()=>[d("tr",null,[d("td",{colspan:A(ee).length+2,class:"text-center py-10"},[a(he,{size:"80",color:"primary",variant:"tonal"},{default:t(()=>[Je]),_:1}),d("div",He,_(e.$t("t-search-not-found-message")),1)],8,qe)])]),key:"0"}]),1032,["headers","items","items-per-page","total-items","loading","search-query"])]),_:1})]),_:1}),i.value?(L(),B(De,{key:0,modelValue:R.value,"onUpdate:modelValue":l[2]||(l[2]=s=>R.value=s),data:i.value,error:w.value,onOnSubmit:P},null,8,["modelValue","data","error"])):D("",!0),i.value?(L(),B(ke,{key:1,modelValue:$.value,"onUpdate:modelValue":l[3]||(l[3]=s=>$.value=s),data:i.value},null,8,["modelValue","data"])):D("",!0),x.value?(L(),B($e,{key:2,modelValue:g.value,"onUpdate:modelValue":l[4]||(l[4]=s=>g.value=s),onOnConfirm:re,loading:n.value},null,8,["modelValue","loading"])):D("",!0)],64))}}),Ze=H({__name:"ListView",setup(c){return(m,p)=>{const f=U("Breadcrumb");return L(),E(Q,null,[a(f,{title:"leave-reason-list",items:A(Re)},null,8,["items"]),a(Ke)],64)}}});export{Ze as default};
