import{d as H,l as i,c as O,J as K,B,b as $,e as k,w as a,x as t,O as M,aD as J,C as W,y as ae,a1 as ue,h as E,D as R,G as D,i as r,Q as j,I as h,f as U,a3 as se,ab as le,Z as re,$ as q,K as de,L as pe,af as ce,m as me,M as N,aF as ve,N as fe,g as z,R as ge,H as ye,F as G,E as he,S as _e,V as Ve,W as Ie}from"./index-1db35709.js";import{_ as Te}from"./TableAction.vue_vue_type_script_setup_true_lang-6eb16471.js";import{D as $e}from"./DataTableServer-f256364c.js";const xe=[{title:"institution-types",disabled:!1},{title:"view-institution-type-list",disabled:!0}],ee=[{title:"name",key:"name",sortable:!0},{title:"description",key:"description",sortable:!0},{title:"action",sortable:!1}],we={class:"font-weight-bold text-caption mb-1"},Ce=r("i",{class:"ph-asterisk ph-xs text-danger"},null,-1),be={key:0,class:"text-red text-extra-small pt-1"},Se={class:"font-weight-bold text-caption mb-1"},Pe={key:0,class:"text-red text-extra-small pt-1"},De=r("i",{class:"ph-x me-1"},null,-1),Ee=H({__name:"CreateUpdateInstitutionTypeModal",props:{modelValue:{type:Boolean,default:!1},data:{type:Object,required:!0},error:{type:String,default:""}},emits:["update:modelValue","onSubmit"],setup(c,{emit:m}){const v=i(!1),f=m,x=c,I=O(()=>x.data.id==="-1"),u=i(x.data),g=O({get(){return x.modelValue},set(n){f("update:modelValue",n)}}),T=i(u.value.id||""),o=i(u.value.name||""),d=i(u.value.description||""),p=O(()=>x.error),_=i({name:"",description:""}),{t:A}=K(),C=()=>{let n=!0;return Object.keys(_.value).forEach(V=>{_.value[V]=""}),o.value||(_.value.name=A("t-please-enter-name-institution-type"),n=!1),n},w=()=>{if(!C())return;v.value=!0;const n={...!I.value&&{id:T.value},name:o.value,description:d.value};f("onSubmit",n,{onSuccess:()=>{g.value=!1},onFinally:()=>{v.value=!1}})};return(n,V)=>{const F=B("TextField"),Q=B("TextArea"),L=B("Card");return $(),k(le,{modelValue:g.value,"onUpdate:modelValue":V[4]||(V[4]=P=>g.value=P),width:"500",scrollable:""},{default:a(()=>[t(L,{title:I.value?n.$t("t-add-institution-type"):n.$t("t-edit-institution-type"),"title-class":"py-0",style:{overflow:"hidden"}},{"title-action":a(()=>[t(M,{icon:"ph-x",variant:"plain",onClick:V[0]||(V[0]=P=>g.value=!1)})]),default:a(()=>[t(J),t(W,{class:"overflow-y-auto",style:ae({"max-height":I.value?"70vh":"45vh"})},{default:a(()=>[p.value?($(),k(ue,{key:0,text:p.value,type:"error",class:"mb-4",variant:"tonal",color:"danger",density:"compact"},null,8,["text"])):E("",!0),t(R,null,{default:a(()=>[t(D,{cols:"12",lg:"12"},{default:a(()=>[r("div",we,[j(h(n.$t("t-name"))+" ",1),Ce]),t(F,{modelValue:o.value,"onUpdate:modelValue":V[1]||(V[1]=P=>o.value=P),placeholder:n.$t("t-enter-name"),"error-messages":_.value.name?[_.value.name]:[],"hide-details":""},null,8,["modelValue","placeholder","error-messages"]),_.value.name?($(),U("div",be,h(_.value.name),1)):E("",!0)]),_:1}),t(D,{cols:"12",lg:"12"},{default:a(()=>[r("div",Se,h(n.$t("t-description")),1),t(Q,{modelValue:d.value,"onUpdate:modelValue":V[2]||(V[2]=P=>d.value=P),placeholder:n.$t("t-enter-description"),"error-messages":_.value.description?[_.value.description]:[],"hide-details":""},null,8,["modelValue","placeholder","error-messages"]),_.value.description?($(),U("div",Pe,h(_.value.description),1)):E("",!0)]),_:1})]),_:1})]),_:1},8,["style"]),t(J),t(se,{class:"d-flex justify-end"},{default:a(()=>[r("div",null,[t(M,{color:"danger",class:"me-1",onClick:V[3]||(V[3]=P=>g.value=!1)},{default:a(()=>[De,j(" "+h(n.$t("t-close")),1)]),_:1}),t(M,{color:"primary",variant:"elevated",onClick:w,loading:v.value,disabled:v.value},{default:a(()=>[j(h(v.value?n.$t("t-saving"):n.$t("t-save")),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])}}});const Ue={class:"font-weight-bold text-caption mb-1"},Oe=r("i",{class:"ph-asterisk ph-xs text-danger"},null,-1),Be={key:0,class:"text-red text-extra-small pt-1"},Fe={class:"font-weight-bold text-caption mb-1"},ke={key:0,class:"text-red text-extra-small pt-1"},Me=r("i",{class:"ph-x me-1"},null,-1),je=H({__name:"ViewInstitutionTypeModal",props:{modelValue:{type:Boolean,default:!1},data:{type:Object,required:!0}},emits:["update:modelValue","onSubmit"],setup(c,{emit:m}){i(!1);const v=m,f=c,x=O(()=>f.data.id==="-1"),I=i(f.data),u=O({get(){return f.modelValue},set(d){v("update:modelValue",d)}});i(I.value.id||"");const g=i(I.value.name||""),T=i(I.value.description||""),o=i({name:"",description:""});return K(),(d,p)=>{const _=B("TextField"),A=B("TextArea"),C=B("Card");return $(),k(le,{modelValue:u.value,"onUpdate:modelValue":p[4]||(p[4]=w=>u.value=w),width:"500",scrollable:""},{default:a(()=>[t(C,{title:d.$t("t-view-institution-type"),"title-class":"py-0",style:{overflow:"hidden"}},{"title-action":a(()=>[t(M,{icon:"ph-x",variant:"plain",onClick:p[0]||(p[0]=w=>u.value=!1)})]),default:a(()=>[t(J),t(W,{class:"overflow-y-auto",style:ae({"max-height":x.value?"70vh":"45vh"})},{default:a(()=>[t(R,null,{default:a(()=>[t(D,{cols:"12",lg:"12"},{default:a(()=>[r("div",Ue,[j(h(d.$t("t-name"))+" ",1),Oe]),t(_,{modelValue:g.value,"onUpdate:modelValue":p[1]||(p[1]=w=>g.value=w),placeholder:d.$t("t-enter-name"),"error-messages":o.value.name?[o.value.name]:[],"hide-details":"",disabled:""},null,8,["modelValue","placeholder","error-messages"]),o.value.name?($(),U("div",Be,h(o.value.name),1)):E("",!0)]),_:1}),t(D,{cols:"12",lg:"12"},{default:a(()=>[r("div",Fe,h(d.$t("t-description")),1),t(A,{modelValue:T.value,"onUpdate:modelValue":p[2]||(p[2]=w=>T.value=w),placeholder:d.$t("t-enter-description"),"error-messages":o.value.description?[o.value.description]:[],"hide-details":"",disabled:""},null,8,["modelValue","placeholder","error-messages"]),o.value.description?($(),U("div",ke,h(o.value.description),1)):E("",!0)]),_:1})]),_:1})]),_:1},8,["style"]),t(J),t(se,{class:"d-flex justify-end"},{default:a(()=>[r("div",null,[t(M,{color:"danger",class:"me-1",onClick:p[3]||(p[3]=w=>u.value=!1)},{default:a(()=>[Me,j(" "+h(d.$t("t-close")),1)]),_:1})])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])}}});const Ae=re("institution_types",{state:()=>({institution_types:[],pagination:{totalElements:0,currentPage:0,itemsPerPage:10,totalPages:0},loading:!1,error:null,draftInstitutionType:null,currentInstitutionTypeId:null}),actions:{async fetchInstitutionTypes(c,m,v="name",f="asc",x,I){this.loading=!0,this.error=null;const u=c??this.pagination.currentPage,g=m??this.pagination.itemsPerPage;try{const{content:T,meta:o}=await q.getInstitutionTypes(u,g,v,f,x,I);this.institution_types=T,this.pagination={totalElements:o.totalElements,currentPage:o.page,itemsPerPage:o.size,totalPages:o.totalPages||Math.ceil(o.totalElements/o.size)},console.log("🏛️ Tipos de Instituições:",this.institution_types),console.log("📄 Meta:",this.pagination)}catch(T){this.error=T.message||"Erro ao buscar os tipos de instituições",this.institution_types=[],this.pagination.totalElements=0,console.error("❌ Erro ao buscar institution_types:",T)}finally{this.loading=!1}},setDraftInstitutionType(c){this.draftInstitutionType=c,localStorage.setItem("draftInstitutionType",JSON.stringify(c)),console.log("📋 Draft de tipo de instituição salvo:",this.draftInstitutionType)},setCurrentInstitutionTypeId(c){this.currentInstitutionTypeId=c,localStorage.setItem("currentInstitutionTypeId",c),console.log("🆔 ID do tipo de instituição atual salvo:",this.currentInstitutionTypeId)},clearDraft(){this.draftInstitutionType=null,this.currentInstitutionTypeId=null,localStorage.removeItem("draftInstitutionType"),localStorage.removeItem("currentInstitutionTypeId"),console.log("🧹 Draft e ID de tipo de instituição limpos")},loadFromStorage(){const c=localStorage.getItem("draftInstitutionType"),m=localStorage.getItem("currentInstitutionTypeId");c&&(this.draftInstitutionType=JSON.parse(c)),m&&(this.currentInstitutionTypeId=m),console.log("📦 Carregado do armazenamento:",this.draftInstitutionType,this.currentInstitutionTypeId)}}}),ze={class:"text-body-1 font-weight-bold"},Le=r("i",{class:"ph-plus-circle me-1"},null,-1),Ne={style:{"padding-right":"200px"}},qe={style:{"padding-right":"200px"}},Je=["colspan"],Re=r("i",{class:"ph-magnifying-glass",style:{"font-size":"30px"}},null,-1),He={class:"text-subtitle-1 font-weight-bold mt-3"},te="name,description",Qe=H({__name:"index",setup(c){const{t:m}=K(),v=de(),f=Ae();pe();const x=i(!1),I=i(!1),u=i(null),g=i(!1),T=i(null),o=i(!1);i(!1);const d=i(""),p=i(10),_=O(()=>f.loading),A=O(()=>f.pagination.totalElements),C=i([]),w=i("");let n=null;const V=e=>{var l,y,S,b,Z,X,Y;n&&(clearTimeout(n),n=null);const s=((Z=(b=(S=(y=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:y.error)==null?void 0:S.errors)==null?void 0:b.name)==null?void 0:Z[0])||((Y=(X=e==null?void 0:e.response)==null?void 0:X.data)==null?void 0:Y.message)||(e==null?void 0:e.message)||m("t-message-save-error");console.error("Erro:",s),w.value=s,n=setTimeout(()=>{w.value="",n=null},5e3)};ce(()=>{n&&(clearTimeout(n),n=null)}),me(()=>{F({page:1,itemsPerPage:p.value,sortBy:[],search:""})}),N(C,e=>{console.log("Funcionários selecionados:",e)},{deep:!0});const F=async({page:e,itemsPerPage:s,sortBy:l,search:y})=>{var S,b;await f.fetchInstitutionTypes(e-1,s,((S=l[0])==null?void 0:S.key)||"name",((b=l[0])==null?void 0:b.order)||"asc",y,te)},Q=e=>{C.value.findIndex(l=>l.id===e.id)===-1?C.value=[...C.value,e]:C.value=C.value.filter(l=>l.id!==e.id)};N(x,e=>{e||(u.value=null)});const L=e=>{e?u.value=e:u.value={id:"-1",name:"",description:""},x.value=!0},P=async(e,s)=>{var l,y;try{e.id?(await q.updateInstitutionType(e.id,e),v.success(m("t-toast-message-update"))):(await q.createInstitutionType(e),v.success(m("t-toast-message-created"))),await F({page:1,itemsPerPage:p.value,sortBy:[],search:d.value}),(l=s==null?void 0:s.onSuccess)==null||l.call(s)}catch(S){v.error(m("t-message-save-error")),V(S)}finally{(y=s==null?void 0:s.onFinally)==null||y.call(s)}};N(I,e=>{e||(u.value=null)});const ne=e=>{e?u.value=e:u.value={id:"-1",name:"",description:""},I.value=!0};N(g,e=>{e||(T.value=null)});const oe=e=>{T.value=e,g.value=!0},ie=async()=>{o.value=!0;try{await q.deleteInstitutionType(T.value),await F({page:1,itemsPerPage:p.value,sortBy:[],search:d.value}),v.success(m("t-toast-message-deleted"))}catch(e){v.error(m("t-toast-message-deleted-erros")),V(e)}finally{o.value=!1,g.value=!1}};return(e,s)=>($(),U(G,null,[t(Ve,null,{default:a(()=>[t(ve,{class:"mt-2"},{default:a(()=>[t(R,{justify:"space-between",align:"center","no-gutters":""},{default:a(()=>[t(D,{lg:"auto",class:"d-flex align-center"},{default:a(()=>[r("span",ze,h(e.$t("t-institution-type-list")),1)]),_:1}),t(D,{lg:"8",class:"d-flex justify-end"},{default:a(()=>[t(R,{justify:"end",align:"center","no-gutters":""},{default:a(()=>[t(D,{lg:"4",class:"me-3"},{default:a(()=>[t(fe,{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=l=>d.value=l),placeholder:e.$t("t-search-for-institution-type")},null,8,["modelValue","placeholder"])]),_:1}),t(D,{lg:"auto"},{default:a(()=>[t(M,{color:"secondary",onClick:s[1]||(s[1]=l=>L(null))},{default:a(()=>[Le,j(" "+h(e.$t("t-add-institution-type")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(W,{class:"mt-2"},{default:a(()=>[t($e,{headers:z(ee).map(l=>({...l,title:e.$t(`t-${l.title}`)})),items:z(f).institution_types,"items-per-page":p.value,"total-items":A.value,loading:_.value,"search-query":d.value,"search-props":te,"item-value":"id",onLoadItems:F},ge({body:a(({items:l})=>[($(!0),U(G,null,he(l,y=>{var S;return $(),U("tr",{key:y.id,height:"50"},[r("td",null,[t(_e,{"model-value":C.value.some(b=>b.id===y.id),"onUpdate:modelValue":b=>Q(y),"hide-details":"",density:"compact"},null,8,["model-value","onUpdate:modelValue"])]),r("td",Ne,h(y.name),1),r("td",qe,h((S=y.description)==null?void 0:S.toUpperCase()),1),r("td",null,[t(Te,{onOnEdit:b=>L(y),onOnView:b=>ne(y),onOnDelete:b=>oe(y.id)},null,8,["onOnEdit","onOnView","onOnDelete"])])])}),128))]),_:2},[z(f).institution_types.length?void 0:{name:"body",fn:a(()=>[r("tr",null,[r("td",{colspan:z(ee).length+2,class:"text-center py-10"},[t(ye,{size:"80",color:"primary",variant:"tonal"},{default:a(()=>[Re]),_:1}),r("div",He,h(e.$t("t-search-not-found-message")),1)],8,Je)])]),key:"0"}]),1032,["headers","items","items-per-page","total-items","loading","search-query"])]),_:1})]),_:1}),u.value?($(),k(Ee,{key:0,modelValue:x.value,"onUpdate:modelValue":s[2]||(s[2]=l=>x.value=l),data:u.value,error:w.value,onOnSubmit:P},null,8,["modelValue","data","error"])):E("",!0),u.value?($(),k(je,{key:1,modelValue:I.value,"onUpdate:modelValue":s[3]||(s[3]=l=>I.value=l),data:u.value},null,8,["modelValue","data"])):E("",!0),T.value?($(),k(Ie,{key:2,modelValue:g.value,"onUpdate:modelValue":s[4]||(s[4]=l=>g.value=l),onOnConfirm:ie,loading:o.value},null,8,["modelValue","loading"])):E("",!0)],64))}}),Ze=H({__name:"ListView",setup(c){return(m,v)=>{const f=B("Breadcrumb");return $(),U(G,null,[t(f,{title:"institution-type-list",items:z(xe)},null,8,["items"]),t(Qe)],64)}}});export{Ze as default};
